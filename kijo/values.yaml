# -- Number of replicas
replicaCount: 1

# Namespace configuration
# -- Target namespace for deployment (used when namespaceCreate is true)
namespace: "kijo"
# -- Create the target namespace (set to false if namespace already exists)
namespaceCreate: true

image:
  # -- Image repository
  repository: ghcr.io/kijosec/agent
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag (defaults to appVersion)
  tag: ""

# -- Image pull secrets
imagePullSecrets: []
# -- Override the name
nameOverride: ""
# -- Override the full name
fullnameOverride: ""

serviceAccount:
  # -- Create a service account
  create: true
  # -- Annotations for the service account
  annotations: {}
  # -- Name of the service account (generated if not set)
  name: ""

# -- Pod annotations
podAnnotations: {}

# -- Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  fsGroup: 65534

# -- Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false  # SQLite needs to write to /data
  capabilities:
    drop:
      - ALL

# -- Resource requests and limits
resources:
  requests:
    memory: 64Mi
    cpu: 50m
  limits:
    memory: 256Mi
    cpu: 200m

# -- Node selector
nodeSelector: {}

# -- Tolerations
tolerations: []

# -- Affinity rules
affinity: {}

# Agent configuration
config:
  # -- Poll interval for Trivy CRDs
  pollInterval: "5m"
  # -- Namespaces to watch (comma-separated, empty for all)
  namespaces: ""
  # -- Log format (json or text)
  logFormat: "json"
  # -- Log level (debug, info, warn, error)
  logLevel: "info"

# SaaS platform integration
saas:
  # -- Enable SaaS platform integration
  enabled: false
  # -- SaaS platform API endpoint (e.g., https://api.kijosec.dev)
  endpoint: ""
  # -- API key for authentication (use existingSecret for production)
  apiKey: ""
  # -- Use existing secret for API key
  existingSecret: ""
  # -- Key in existing secret
  existingSecretKey: "api-key"

# Health probes
healthCheck:
  # -- Port for health endpoints
  port: 8080

livenessProbe:
  httpGet:
    path: /healthz
    port: health
  initialDelaySeconds: 10
  periodSeconds: 30

readinessProbe:
  httpGet:
    path: /readyz
    port: health
  initialDelaySeconds: 5
  periodSeconds: 10

# Trivy Operator (dependency)
# See knowledge/docs/trivy-configuration.md for detailed explanation
trivy-operator:
  # -- Enable Trivy Operator as a dependency
  enabled: true

  trivy:
    # -- Show all vulnerabilities, including those without fixes
    ignoreUnfixed: false
    # -- Scan job resources - increased for large images (Cilium, Istio, etc.)
    # Default 100M causes OOMKilled on large images
    resources:
      requests:
        cpu: 100m
        memory: 500M
      limits:
        cpu: 500m
        memory: 2Gi

  # -- Enable CIS/NSA/PSS compliance scanning
  compliance:
    enabled: true

  # -- Report TTL - triggers daily re-scans when reports expire
  # Without this, workloads are only scanned on deploy
  scannerReportTTL: "24h"
